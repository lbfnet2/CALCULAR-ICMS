<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportar para Excel</title>
    <!-- Adicione a biblioteca SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
</head>

<body>

    <script>
        // Função para exportar as informações para Excel
        function exportToExcel() {
            // Recupere os dados do Local Storage
            var informacoesSalvas = JSON.parse(localStorage.getItem('informacoes')) || [];

            // Verifique se existem dados para exportar
            if (informacoesSalvas.length > 0) {
                var table = document.createElement('table');
                var infoBody = document.createElement('tbody');

                // Adicione as informações do Local Storage como linhas da tabela
                informacoesSalvas.forEach(function (informacao) {
                    var row = document.createElement('tr');
                    Object.values(informacao).forEach(function (value) {
                        var cell = document.createElement('td');
                        cell.appendChild(document.createTextNode(value));
                        row.appendChild(cell);
                    });
                    infoBody.appendChild(row);
                });

                // Adicione o corpo da tabela ao elemento da tabela
                table.appendChild(infoBody);

                var ws = XLSX.utils.table_to_sheet(table);

                // Criar um livro de Excel e adicionar a planilha
                var wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Informações");

                // Criar um blob com os dados do arquivo Excel
                var blob = new Blob([s2ab(XLSX.write(wb, { type: 'binary' }))], { type: "application/octet-stream" });

                // Criar um link de download para o blob
                var url = window.URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'informacoes.xlsx';

                // Adicionar o link ao documento e clicar nele para iniciar o download
                document.body.appendChild(a);
                a.click();

                // Remover o link e liberar o blob após o download
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                // Redirecionar de volta para puxa.html após o download (opcional)
                setTimeout(function () {
                    window.location.href = 'puxa.html';
                }, 1000); // Redirecionar após 1 segundo (1000 milissegundos)
            } else {
                alert("Não há informações para exportar.");
            }
        }

        // Função para converter string em ArrayBuffer
        function s2ab(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }

        // Exportar para Excel automaticamente ao abrir a página
        exportToExcel();
    </script>

</body>

</html>
