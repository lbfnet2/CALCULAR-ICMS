<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportar para Excel</title>
    <!-- Adicione a biblioteca SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <!-- Carregue o Firebase SDK de forma assíncrona -->
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-storage-compat.js"></script>
</head>

<body>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCOFFHgsYl3gqOpEUOw2DtIyDtgRQhQTDE",
            authDomain: "motora-c2c43.firebaseapp.com",
            projectId: "motora-c2c43",
            storageBucket: "motora-c2c43.appspot.com",
            messagingSenderId: "533447273603",
            appId: "1:533447273603:web:02214de57d8bfb49413fb6",
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();

        // Função para exportar as informações para Excel e salvar no Firebase Storage
        function exportToExcelAndSave() {
            // Recupere os dados do Local Storage
            var informacoesSalvas = JSON.parse(localStorage.getItem('informacoes')) || [];

            // Verifique se existem dados para exportar
            if (informacoesSalvas.length > 0) {
                var table = document.createElement('table');
                var infoBody = document.createElement('tbody');

                // Adicione as informações do Local Storage como linhas da tabela
                informacoesSalvas.forEach(function (informacao) {
                    var row = document.createElement('tr');
                    Object.values(informacao).forEach(function (value) {
                        var cell = document.createElement('td');
                        cell.appendChild(document.createTextNode(value));
                        row.appendChild(cell);
                    });
                    infoBody.appendChild(row);
                });

                // Adicione o corpo da tabela ao elemento da tabela
                table.appendChild(infoBody);

                var ws = XLSX.utils.table_to_sheet(table);

                // Criar um livro de Excel e adicionar a planilha
                var wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Informações");

                // Converter o arquivo Excel para um blob
                var wbBlob = new Blob([s2ab(XLSX.write(wb, { type: 'binary' }))], { type: "application/octet-stream" });

                // Criar uma referência para o arquivo no Firebase Storage
                var storageRef = storage.ref('caminho/para/seu/arquivo.xlsx');

                // Fazer o upload do blob para o Firebase Storage
                storageRef.put(wbBlob).then(function (snapshot) {
                    console.log('Arquivo Excel enviado para o Firebase Storage com sucesso!');
                    // Redirecionar de volta após o upload (opcional)
                    setTimeout(function () {
                        window.location.href = 'puxa.html';
                    }, 1000); // Redirecionar após 1 segundo (1000 milissegundos)
                }).catch(function (error) {
                    console.error('Erro ao enviar o arquivo Excel para o Firebase Storage:', error);
                });
            } else {
                alert("Não há informações para exportar.");
            }
        }

        // Função para converter string em ArrayBuffer
        function s2ab(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }

        // Exportar para Excel e salvar no Firebase Storage automaticamente ao abrir a página
        exportToExcelAndSave();
    </script>

</body>

</html>